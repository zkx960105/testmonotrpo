{"version":3,"sources":["../../src/plugins.ts"],"sourcesContent":["// const ERROR_CONSTANT = ['onerror','onunhandledrejection']\r\nimport { currrntClient } from \"./core/src/index\"\r\n\r\ntype ErrorOptionsKeys = 'onerror' | 'onunhandledrejection';\r\n\r\ntype ErrorOptions = Record<ErrorOptionsKeys,Boolean>\r\n\r\ntype ErrorType = {\r\n    type: string,\r\n    message: WechatMiniprogram.Error\r\n}\r\n\r\ntype onUnhandledRejection = {\r\n    type: string,\r\n    message: WechatMiniprogram.OnUnhandledRejectionListenerResult\r\n}\r\n\r\nimport { eventHandler } from \"./global\"\r\n\r\nexport function wechatError() {\r\n\r\n    return function(options: Partial<ErrorOptions> = {}) {\r\n\r\n        if(currrntClient === undefined) {\r\n            throw new Error(\"client is not instantiated\")\r\n        }\r\n        const _options = {\r\n            onerror: true,\r\n            onunhandledrejection: true,\r\n            ...options\r\n        }\r\n        if(_options.onerror) {\r\n            initOnError()\r\n        }\r\n        if(_options.onunhandledrejection) {\r\n            initOnunhandledrejection()\r\n        }\r\n        //...extra\r\n    }\r\n}\r\n\r\nfunction initOnError() {\r\n    wx.onError(message => {\r\n        const event: ErrorType = {\r\n            type: 'error',\r\n            message: message\r\n        }\r\n        eventHandler['error'].push(event)\r\n        currrntClient!.triggerSend(event)\r\n    })\r\n}\r\n\r\nfunction initOnunhandledrejection() {\r\n    wx.onUnhandledRejection(reason => {\r\n        // eventHandler['unhandledrejection'].push(reason)\r\n        const event: onUnhandledRejection = {\r\n            type: 'unhandledrejection',\r\n            message: reason\r\n        }\r\n        eventHandler['unhandledrejection'].push(event)\r\n        currrntClient!.triggerSend(event)\r\n    })\r\n}\r\n\r\nexport function defaultIntegrations() {\r\n    return [wechatError]\r\n}"],"mappings":"kFAmBO,SAASA,GAAc,CAE1B,OAAO,SAASC,EAAiC,CAAC,EAAG,CAEjD,GAAGC,IAAkB,OACjB,MAAM,IAAI,MAAM,4BAA4B,EAEhD,IAAMC,EAAW,CACb,QAAS,GACT,qBAAsB,GACtB,GAAGF,CACP,EACGE,EAAS,SACRC,EAAY,EAEbD,EAAS,sBACRE,EAAyB,CAGjC,CACJ,CAEA,SAASD,GAAc,CACnB,GAAG,QAAQE,GAAW,CAClB,IAAMC,EAAmB,CACrB,KAAM,QACN,QAASD,CACb,EACAE,EAAa,MAAS,KAAKD,CAAK,EAChCL,EAAe,YAAYK,CAAK,CACpC,CAAC,CACL,CAEA,SAASF,GAA2B,CAChC,GAAG,qBAAqBI,GAAU,CAE9B,IAAMF,EAA8B,CAChC,KAAM,qBACN,QAASE,CACb,EACAD,EAAa,mBAAsB,KAAKD,CAAK,EAC7CL,EAAe,YAAYK,CAAK,CACpC,CAAC,CACL,CAEO,SAASG,GAAsB,CAClC,MAAO,CAACV,CAAW,CACvB","names":["wechatError","options","currrntClient","_options","initOnError","initOnunhandledrejection","message","event","eventHandler","reason","defaultIntegrations"]}